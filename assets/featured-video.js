class FeaturedVideoSection extends HTMLElement{constructor(){super()}connectedCallback(){this.api=this.getAttribute("data-api"),this.autoplay="true"===this.getAttribute("data-autoplay"),this.play_button=this.querySelector(".featured-video--play"),this.id=this.getAttribute("data-id"),this.video_id=this.getAttribute("data-video-id"),this.video_wrapper=this.querySelector(".featured-video--wrapper"),this.autoplay?this.loadLibraries():this.playButtonListeners()}loadLibraries(){switch(this.api){case"youtube":window.on("theme:youtube:apiReady",()=>this.insertYoutubePlayer()),"loaded"===theme.scripts.youtube?this.insertYoutubePlayer():theme.utils.libraryLoader("youtube","https://"+theme.libraries.youtube,window.onYouTubeIframeAPIReady);break;case"vimeo":theme.utils.libraryLoader("vimeo","https://"+theme.libraries.vimeo,()=>this.insertVimeoPlayer());break;case"plyr":theme.utils.stylesheetLoader("plyr",theme.libraries.plyr+".css"),theme.utils.libraryLoader("plyr",theme.libraries.plyr+".en.js",()=>{this.insertPlyrPlayer()})}}insertVimeoPlayer(){void 0!==Vimeo.Player&&(this.vimeo=new Vimeo.Player("player-"+this.id,{id:this.video_id,autopause:0,playsinline:this.autoplay?1:0,muted:this.autoplay?1:0,background:this.autoplay?1:0,loop:this.autoplay?1:0,title:0}),this.vimeo.ready().then(()=>{this.showPlayer(),this.autoplay||this.vimeoEvents(),this.trigger("theme:video:loaded")}),Promise.all([this.vimeo.getVideoWidth(),this.vimeo.getVideoHeight()]).then(([e,t])=>this.setAspectRatio(t,e)),this.vimeo.play())}vimeoEvents(){this.vimeo.getDuration().then(e=>{this.vimeo.addCuePoint(e-.3,{})}),this.vimeo.on("cuepoint",()=>{this.vimeo.setCurrentTime(0),this.vimeo.pause()})}insertYoutubePlayer(){var e,t;void 0!==YT.Player&&({height:e,width:t}=new YT.Player("player-"+this.id,{videoId:this.video_id,playerVars:{enablejsapi:1,host:"https://www.youtube.com",origin:location.origin},events:{onReady:({target:e})=>this.youtubeReady(e),onStateChange:e=>this.youtubeEvents(e)}}).getIframe(),this.setAspectRatio(e,t))}youtubeReady(e){this.autoplay&&e.mute(),this.showPlayer(),e.playVideo(),this.trigger("theme:video:loaded")}youtubeEvents({target:e,data:t}){this.autoplay||0!==t?this.autoplay&&0===t&&e.playVideo():(e.seekTo(0),e.pauseVideo())}insertPlyrPlayer(){var e;void 0===Shopify.Video||this.autoplay||((e=this.video_wrapper.querySelector("video")).on("ready",()=>this.showPlayer()),new Shopify.Video(e,{autoplay:!0,hideControls:!0,muted:!1,loop:{active:!1},controls:["play","progress","current-time","mute","volume","captions","settings","pip","airplay","fullscreen"]}))}showPlayer(){setTimeout(()=>{this.autoplay||this.setAttribute("data-overlay-style","none"),this.video_wrapper.setAttribute("data-transition-active",!0),this.trigger("theme:video:loaded")},50)}setAspectRatio(e,t){this.style.setProperty("--natural-aspect-ratio",(t/e).toFixed(4))}playButtonListeners(){this.play_button.on("click keydown",e=>{"keydown"===e.type&&"Enter"!==e.key||(e.preventDefault(),this.loadLibraries(),setTimeout(()=>this.setAttribute("data-loaded",!0),400))})}}const featuredVideoEl=customElements.get("featured-video");featuredVideoEl||customElements.define("featured-video",FeaturedVideoSection);