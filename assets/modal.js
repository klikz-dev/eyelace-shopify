class Modal extends HTMLElement{static instances={};static status="closed";static viewport=document.querySelector(".layout--viewport");static close_button=document.querySelector(".layout--close");static next_button=document.querySelector(".layout--next");static previous_button=document.querySelector(".layout--previous");constructor(){super(),(Modal.instances[this.dataset.id]=this).blocking=null!==this.dataset.blocking&&this.dataset.blocking,this.close_buttons=this.querySelectorAll("[data-modal-close]"),this.focus_triggers=this.querySelectorAll(".modal--focus-trigger"),this.next_buttons=this.querySelectorAll('[data-modal-button="next"]'),this.previous_buttons=this.querySelectorAll('[data-modal-button="previous"]'),this.views=this.querySelectorAll(".modal--view"),this.trigger=document.querySelector("#a11y_skip"),this.state={active_index:0,previous_index:this.views.length-1,active_view:this.views[0],previous_view:this.views[this.views.length-1],view_disabled:!1}}connectedCallback(){!this.blocking||Shopify.designMode||window.localStorage&&void 0!==localStorage[theme.local_storage[this.blocking]]||this.open()}disconnectedCallback(){this.close()}updateStatus(t){Modal.status=t,Modal.viewport.setAttribute("data-modal-status",t)}open(){"opened"!==Modal.status&&(this.window_offset=window.scrollY,Modal.viewport.setStyles({top:0===this.window_offset?"0px":`-${this.window_offset}px`,position:"fixed"}),Modal.viewport.setAttribute("data-modal-view",this.dataset.id),this.setAttribute("aria-hidden",!1),this.updateStatus("opened"),setTimeout(()=>{this.on("transitionend",()=>this.opened(),{once:!0}),this.setAttribute("data-transition-active",!0),this.blocking||Modal.toggleButtons(!0,1<this.views.length)},0),this.addListeners())}opened(){var t=document.getElementById(this.getAttribute("data-focus-id"));(t||Modal.close_button).focus()}addListeners(){(this.next_buttons.length?this.next_buttons:Modal.next_button).on(`click.${this.dataset.id}-modal`,()=>this.toggleView("next")),(this.close_buttons.length?this.close_buttons:Modal.close_button).on(`click.${this.dataset.id}-modal`,()=>this.close()),(this.previous_buttons.length?this.previous_buttons:Modal.previous_button).on(`click.${this.dataset.id}-modal`,()=>this.toggleView("previous")),this.blocking||(window.on(`keydown.${this.dataset.id}-modal`,({key:t})=>{var e=1<this.views.length&&!this.blocking;"Escape"===t?this.close():"ArrowLeft"===t?e&&this.toggleView("previous"):"ArrowRight"===t&&e&&this.toggleView("next")}),this.on(`click.${this.dataset.id}-modal`,({target:t})=>t===this&&this.close()),this.focus_triggers.length&&this.focus_triggers.on(`focus.${this.dataset.id}-modal`,()=>this.close()))}close(){"closed"===Modal.status||this.state.view_disabled||(Modal.viewport.removeAttribute("style"),this.on("transitionend",()=>this.closed(),{once:!0}),!Shopify.designMode&&this.trigger&&this.trigger.focus(),window.scrollTo(0,this.window_offset),this.setAttribute("data-transition-type","fade-out"),this.updateStatus("closed"),this.blocking?localStorage[theme.local_storage[this.blocking]]="true":Modal.toggleButtons(!1),this.removeListeners())}closed(){this.setAttribute("data-transition-type","fade-in"),this.setAttribute("data-transition-active",!1),this.setAttribute("aria-hidden",!0)}removeListeners(){var t=this.next_buttons.length?this.next_buttons:Modal.next_button,e=this.close_buttons.length?this.close_buttons:Modal.close_button;[t,this.previous_buttons.length?this.previous_buttons:Modal.previous_button,e].off(`click.${this.dataset.id}-modal`),this.blocking||(window.off(`keydown.${this.dataset.id}-modal`),this.off(`click.${this.dataset.id}-modal`),this.focus_triggers.length&&this.focus_triggers.off(`focus.${this.dataset.id}-modal`))}toggleView(e){if(!this.state.view_disabled){let t=!0;"next"===e?this.updateView(this.state.active_index+1,!0):"previous"===e?this.updateView(this.state.active_index-1):isNaN(e)||(this.updateView(e,!0),t=!1),t?(this.state.previous_view.on("transitionend",()=>{this.state.active_view.setAttribute("data-transition-active",!0),this.state.previous_view.setAttribute("data-transition-type","fade-in"),this.state.previous_view.setAttribute("data-transition-active",!1)},{once:!0}),this.state.active_view.on("transitionend",()=>{this.state.active_view.setAttribute("data-transition-type","fade-out"),this.state.active_view.setAttribute("data-transition-active",!1),this.state.view_disabled=!1},{once:!0}),this.state.view_disabled=!0,this.state.previous_view.setAttribute("data-transition-active",!0)):this.views.forEach(t=>{var e=t===this.state.active_view;t.setAttribute("data-transition-type",e?"fade-out":"fade-in"),t.setAttribute("data-transition-active",!1)})}}updateView(t,e){t>this.views.length-1?(this.state.active_index=0,this.state.previous_index=this.views.length-1):t<0?(this.state.previous_index=0,this.state.active_index=this.views.length-1):(this.state.previous_index=0===t?e?this.views.length-1:1:this.state.active_index,this.state.active_index=t),this.state.active_view=this.views[this.state.active_index],this.state.previous_view=this.views[this.state.previous_index]}static toggleButtons(t,e=!1){Modal.close_button.setAttribute("aria-hidden",!t),[Modal.previous_button,Modal.next_button].forEach(t=>t.setAttribute("aria-hidden",!e))}}theme.modal=Modal,customElements.define("modal-root",Modal);class ModalTrigger extends HTMLElement{constructor(){super()}connectedCallback(){this.delay=parseInt(this.getAttribute("data-delay")),this.on(`click.${this.dataset.id}-modal-trigger keydown.${this.dataset.id}-modal-trigger`,t=>{if("keydown"!==t.type||"Enter"===t.key){const i=theme.modal.instances[this.dataset.id];var e=(i.trigger=this).getAttribute("data-index");e&&i.toggleView(parseInt(e),!1),"closed"!==theme.drawer.status&&theme.drawer.close(),isNaN(this.delay)?i.open():setTimeout(()=>i.open(),this.delay)}})}disconnectedCallback(){this.off(`click.${this.dataset.id}-modal-trigger keydown.${this.dataset.id}-modal-trigger`)}}theme.modal=Modal,customElements.define("modal-trigger",ModalTrigger);