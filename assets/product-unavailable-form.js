class ProductUnavailableForm extends HTMLElement{constructor(){super()}connectedCallback(){this.form_value=this.querySelector(".product-unavailable--value"),this.input=this.querySelector(".product-unavailable--input"),this.submit=this.querySelector(".product-unavailable--submit"),this.submitListener(),this.displayListener()}submitListener(){this.submit.on("click",t=>{t.preventDefault(),theme.utils.isValidEmail(this.input.value)?this.sendRequest():theme.feedback.load("email-invalid")})}async sendRequest(){this.setAttribute("aria-busy",!0),this.submit.setAttribute("disabled",!0);var t=await fetch(theme.urls.root+"/contact",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({form_type:"contact",contact:{email:this.input.value,message:this.form_value.value}})});if(t.redirected&&!t.url.includes("contact_posted=true"))window.location.href=t.url;else{if(!t.ok)throw new Error(t.statusText);this.input.value="",theme.feedback.load("product-form"),this.setAttribute("aria-busy",!1),this.submit.removeAttribute("disabled")}}displayListener(){window.on(`theme:product:${this.dataset.id}:variantChanged`,({detail:{variant:t}})=>{this.setAttribute("aria-hidden",!t||t.available),t&&(this.form_value.value=this.form_value.value.split(":")[0]+": "+t.name)})}}const productUnavailableFormEl=customElements.get("product-unavailable-root");productUnavailableFormEl||customElements.define("product-unavailable-root",ProductUnavailableForm);